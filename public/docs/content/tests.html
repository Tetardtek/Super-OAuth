<div class="content-section">
    <h1 aria-label="Tests et QualitÃ©" tabindex="0">ğŸ§ª Tests et QualitÃ©</h1>
    <p class="intro">Documentation complÃ¨te de la suite de tests SuperOAuth avec 249 tests unitaires frontend.</p>
</div>

<div class="content-section">
    <h2 aria-label="Vue d'ensemble" tabindex="0">ğŸ“Š Vue d'ensemble</h2>
    <div class="info-grid">
        <div class="info-card">
            <h3>ğŸ“ˆ Frontend</h3>
            <ul>
                <li><strong>Framework:</strong> Vitest + jsdom</li>
                <li><strong>Tests:</strong> 249 tests âœ…</li>
                <li><strong>Taux de RÃ©ussite:</strong> 100%</li>
                <li><strong>DurÃ©e:</strong> ~5 secondes</li>
                <li><strong>Coverage:</strong> V8 provider (>80%)</li>
            </ul>
        </div>
        <div class="info-card">
            <h3>ğŸ—ï¸ Backend</h3>
            <ul>
                <li><strong>Framework:</strong> Jest + ts-jest</li>
                <li><strong>Tests:</strong> 30 tests âœ…</li>
                <li><strong>Taux de RÃ©ussite:</strong> 100%</li>
                <li><strong>Coverage:</strong> Focus domaine</li>
            </ul>
        </div>
        <div class="info-card">
            <h3>ğŸ“Š Total</h3>
            <ul>
                <li><strong>Tests Total:</strong> 279 tests</li>
                <li><strong>Suites:</strong> 16 modules</li>
                <li><strong>Frameworks:</strong> 2 (Vitest + Jest)</li>
                <li><strong>Statut Global:</strong> âœ… 100%</li>
            </ul>
        </div>
    </div>
</div>

<div class="content-section">
    <h2 aria-label="Quick Start" tabindex="0">ğŸš€ Quick Start</h2>
    <div class="code-block">
        <h3>Commandes Essentielles</h3>
        <pre><code># Tests frontend complets (249 tests)
npm run test:frontend

# Tests backend complets
npm run test

# Mode dÃ©veloppement (watch)
npm run test:frontend -- --watch

# Interface graphique
npm run test:frontend -- --ui

# Rapports de couverture
npm run test:frontend -- --coverage

# Test fichier spÃ©cifique
npm run test:frontend -- tests/frontend/unit/utils/validation.test.js

# Tests modifiÃ©s uniquement
npm run test:frontend -- --changed

# Tests en parallÃ¨le (plus rapide)
npm run test:frontend -- --threads</code></pre>
    </div>
</div>

<div class="content-section">
    <h2 aria-label="Architecture Frontend" tabindex="0">ğŸ¯ Architecture des Tests Frontend</h2>

    <h3>ğŸ“¦ Distribution des 249 Tests</h3>
    <div class="info-grid">
        <div class="info-card">
            <h4>ğŸ”§ Managers (71 tests)</h4>
            <ul>
                <li><strong>ToastManager:</strong> 35 tests</li>
                <li><strong>TokenManager:</strong> 36 tests</li>
            </ul>
            <div class="percentage">28.5% des tests</div>
        </div>

        <div class="info-card">
            <h4>ğŸ› ï¸ Utils (115 tests)</h4>
            <ul>
                <li><strong>Storage:</strong> 21 tests</li>
                <li><strong>Validation:</strong> 28 tests</li>
                <li><strong>HTTP:</strong> 22 tests</li>
                <li><strong>UI:</strong> 14 tests</li>
                <li><strong>Format:</strong> 14 tests</li>
                <li><strong>Logger:</strong> 9 tests</li>
                <li><strong>ErrorHandler:</strong> 7 tests</li>
            </ul>
            <div class="percentage">46.2% des tests</div>
        </div>

        <div class="info-card">
            <h4>ğŸ“¦ Components (63 tests)</h4>
            <ul>
                <li><strong>AuthService:</strong> 15 tests</li>
                <li><strong>Dashboard:</strong> 15 tests</li>
                <li><strong>ServerMonitor:</strong> 15 tests</li>
                <li><strong>SharedUtils:</strong> 18 tests</li>
            </ul>
            <div class="percentage">25.3% des tests</div>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>ğŸ§© DÃ©tails par Module</h2>

    <div class="accordion">
        <!-- ToastManager -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ ToastManager (35 tests)</h3>
            <div class="accordion-content">
                <p><strong>SystÃ¨me de notifications toast avec animations</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… Initialisation et crÃ©ation du container</li>
                    <li>âœ… Affichage des 4 types de toast (success, error, warning, info)</li>
                    <li>âœ… Animations d'entrÃ©e/sortie fluides</li>
                    <li>âœ… Auto-fermeture avec durÃ©e configurable</li>
                    <li>âœ… Fermeture manuelle au clic</li>
                    <li>âœ… Gestion de multiples toasts simultanÃ©s</li>
                    <li>âœ… Edge cases : messages longs, vides, HTML, XSS</li>
                </ul>

                <div class="code-block">
                    <h5>Exemple de Test</h5>
                    <pre><code>it('should create and display a toast', () => {
  const message = 'Test message'
  const toast = manager.show(message)

  expect(toast).toBeTruthy()
  expect(toast.textContent).toContain(message)
})

it('should auto-remove toast after duration', () => {
  manager.show('Test', 'info', 2000)
  vi.advanceTimersByTime(2000)
  // Toast should be removed
})</code></pre>
                </div>
            </div>
        </div>

        <!-- TokenManager -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ”‘ TokenManager (36 tests)</h3>
            <div class="accordion-content">
                <p><strong>Gestion centralisÃ©e des tokens JWT</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… Storage/retrieval des access tokens</li>
                    <li>âœ… Storage/retrieval des refresh tokens</li>
                    <li>âœ… Gestion des informations utilisateur (JSON)</li>
                    <li>âœ… Clear tokens et dÃ©connexion</li>
                    <li>âœ… Validation de l'Ã©tat d'authentification</li>
                    <li>âœ… Edge cases : null, undefined, JSON invalide</li>
                </ul>

                <div class="code-block">
                    <h5>Exemple de Test</h5>
                    <pre><code>it('should store and retrieve tokens', () => {
  manager.setTokens('access-token', 'refresh-token')

  expect(manager.getAccessToken()).toBe('access-token')
  expect(manager.getRefreshToken()).toBe('refresh-token')
})

it('should validate authentication state', () => {
  expect(manager.isAuthenticated()).toBe(false)
  manager.setAccessToken('token')
  expect(manager.isAuthenticated()).toBe(true)
})</code></pre>
                </div>
            </div>
        </div>

        <!-- Storage -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ’¾ Storage Utils (21 tests)</h3>
            <div class="accordion-content">
                <p><strong>Wrapper localStorage avec mÃ©thodes token-specific</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… Get/Set/Remove operations</li>
                    <li>âœ… Token management (getAccessToken, setTokens, etc.)</li>
                    <li>âœ… Clear operations ciblÃ©es</li>
                    <li>âœ… Edge cases : empty strings, null, special chars</li>
                </ul>
            </div>
        </div>

        <!-- Validation -->
        <div class="accordion-item">
            <h3 class="accordion-header">âœ”ï¸ Validation Utils (28 tests)</h3>
            <div class="accordion-content">
                <p><strong>Validation email et mots de passe</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… Validation format email (RFC compliant)</li>
                    <li>âœ… Password strength (8+ chars, uppercase, lowercase, digit, special)</li>
                    <li>âœ… Password matching avec null handling</li>
                    <li>âœ… Edge cases : formats invalides, caractÃ¨res spÃ©ciaux</li>
                </ul>

                <div class="code-block">
                    <h5>Exemple de Test</h5>
                    <pre><code>it('should validate strong password', () => {
  const strong = 'MyP@ssw0rd123'
  expect(Validation.isPasswordStrong(strong)).toBe(true)
})

it('should reject weak password', () => {
  const weak = 'password'
  expect(Validation.isPasswordStrong(weak)).toBe(false)
})</code></pre>
                </div>
            </div>
        </div>

        <!-- HTTP -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸŒ HTTP Client (22 tests)</h3>
            <div class="accordion-content">
                <p><strong>Wrapper fetch API avec gestion auth</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… GET/POST/PUT/DELETE methods</li>
                    <li>âœ… Authorization headers automatiques</li>
                    <li>âœ… Error handling et response parsing</li>
                    <li>âœ… Requests avec/sans authentification</li>
                </ul>
            </div>
        </div>

        <!-- UI Utils -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ¨ UI Utils (14 tests)</h3>
            <div class="accordion-content">
                <p><strong>Helpers de manipulation DOM</strong></p>

                <h4>FonctionnalitÃ©s TestÃ©es</h4>
                <ul>
                    <li>âœ… Show/Hide elements</li>
                    <li>âœ… Get/Set/Clear values</li>
                    <li>âœ… SetHTML pour injection de contenu</li>
                    <li>âœ… setBorderColor avec box-shadow</li>
                    <li>âœ… Gestion Ã©lÃ©ments non-existants</li>
                </ul>
            </div>
        </div>

        <!-- AuthService -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ” AuthService (15 tests)</h3>
            <div class="accordion-content">
                <h4>Tests Critiques</h4>
                <ul>
                    <li>âœ… Login avec credentials valides/invalides</li>
                    <li>âœ… Register avec donnÃ©es valides/email existant</li>
                    <li>âœ… Logout utilisateur</li>
                    <li>âœ… Refresh token valide/expirÃ©</li>
                    <li>âœ… VÃ©rification token</li>
                    <li>âœ… Validation email format</li>
                    <li>âœ… Gestion erreurs rÃ©seau</li>
                    <li>âœ… OAuth flows</li>
                </ul>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ“Š Dashboard Component (15 tests)</h3>
            <div class="accordion-content">
                <h4>Tests Critiques</h4>
                <ul>
                    <li>âœ… Chargement donnÃ©es utilisateur</li>
                    <li>âœ… Affichage informations</li>
                    <li>âœ… Gestion Ã©tats de charge</li>
                    <li>âœ… Navigation entre sections</li>
                    <li>âœ… Actions utilisateur</li>
                    <li>âœ… Validation formulaires</li>
                    <li>âœ… Mise Ã  jour temps rÃ©el</li>
                    <li>âœ… Responsive design</li>
                </ul>
            </div>
        </div>

        <!-- ServerMonitor -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ“¡ Server Monitor (15 tests)</h3>
            <div class="accordion-content">
                <h4>Tests Critiques</h4>
                <ul>
                    <li>âœ… Status serveur et health checks</li>
                    <li>âœ… MÃ©triques temps rÃ©el</li>
                    <li>âœ… Alertes systÃ¨me et seuils</li>
                    <li>âœ… Historique mÃ©triques</li>
                    <li>âœ… Connexion base donnÃ©es</li>
                    <li>âœ… Polling optimisÃ©</li>
                    <li>âœ… Reconnexion automatique</li>
                    <li>âœ… Error recovery</li>
                </ul>
            </div>
        </div>

        <!-- SharedUtils -->
        <div class="accordion-item">
            <h3 class="accordion-header">ğŸ› ï¸ Shared Utils (18 tests)</h3>
            <div class="accordion-content">
                <p><strong>Utilitaires partagÃ©s entre modules</strong></p>
                <div class="utils-grid">
                    <div class="utils-category">
                        <h5>Validation</h5>
                        <ul>
                            <li>âœ… Validation email RFC</li>
                            <li>âœ… Sanitization HTML</li>
                            <li>âœ… URL parsing</li>
                        </ul>
                    </div>
                    <div class="utils-category">
                        <h5>Formatage</h5>
                        <ul>
                            <li>âœ… Formatage dates</li>
                            <li>âœ… Number formatting</li>
                            <li>âœ… Error formatting</li>
                        </ul>
                    </div>
                    <div class="utils-category">
                        <h5>SÃ©curitÃ©</h5>
                        <ul>
                            <li>âœ… XSS prevention</li>
                            <li>âœ… Input sanitization</li>
                            <li>âœ… Token validation</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>âš™ï¸ Configuration Technique</h2>

    <h3>Configuration Vitest</h3>
    <div class="code-block">
        <pre><code>// vitest.config.js
export default defineConfig({
  test: {
    environment: 'jsdom',             // Simulation DOM browser
    setupFiles: ['./tests/frontend/setup.js'],
    globals: true,                    // APIs globales
    coverage: {
      provider: 'v8',                 // Engine V8
      reporter: ['text', 'html', 'lcov'],
      thresholds: {
        global: {
          branches: 80,               // 80% minimum
          functions: 80,
          lines: 80,
          statements: 80
        }
      }
    }
  }
});</code></pre>
    </div>

    <h3>Setup des Mocks</h3>
    <div class="code-block">
        <pre><code>// tests/frontend/setup.js

// Mock localStorage avec stockage fonctionnel
const createLocalStorageMock = () => {
  let store = {}
  return {
    getItem: (key) => key in store ? store[key] : null,
    setItem: (key, value) => { store[key] = String(value) },
    removeItem: (key) => { delete store[key] },
    clear: () => { store = {} }
  }
}
global.localStorage = createLocalStorageMock()

// Mock fetch API
global.fetch = vi.fn()

// Mock console (silent tests)
global.console = {
  ...console,
  log: vi.fn(),
  warn: vi.fn(),
  error: vi.fn()
}</code></pre>
    </div>

    <h3>Mocks Disponibles</h3>
    <div class="info-grid">
        <div class="info-card">
            <h4>Browser APIs</h4>
            <ul>
                <li>localStorage (functional mock)</li>
                <li>sessionStorage (spy mock)</li>
                <li>fetch API</li>
                <li>window.location</li>
                <li>console</li>
            </ul>
        </div>
        <div class="info-card">
            <h4>Timers</h4>
            <ul>
                <li>vi.useFakeTimers()</li>
                <li>vi.advanceTimersByTime()</li>
                <li>Pour tester animations</li>
                <li>Auto-fermeture toasts</li>
            </ul>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>âœï¸ Ã‰crire de Nouveaux Tests</h2>

    <h3>Template de Base</h3>
    <div class="code-block">
        <pre><code>import { describe, it, expect, beforeEach, vi } from 'vitest'
import { ModuleToTest } from '../../../../public/js/path/to/module.js'

describe('ModuleToTest', () => {
  beforeEach(() => {
    // Setup avant chaque test
    vi.clearAllMocks()
    localStorage.clear()
  })

  describe('Feature Group', () => {
    it('should do something specific', () => {
      // Arrange
      const input = 'test'

      // Act
      const result = ModuleToTest.method(input)

      // Assert
      expect(result).toBe('expected')
    })
  })
})</code></pre>
    </div>

    <h3>Bonnes Pratiques</h3>
    <div class="best-practices">
        <div class="practice-category">
            <h3>ğŸ“ Structure AAA</h3>
            <ul>
                <li><strong>Arrange:</strong> PrÃ©parer les donnÃ©es</li>
                <li><strong>Act:</strong> ExÃ©cuter l'action</li>
                <li><strong>Assert:</strong> VÃ©rifier le rÃ©sultat</li>
            </ul>
        </div>

        <div class="practice-category">
            <h3>ğŸ¯ Tests Descriptifs</h3>
            <ul>
                <li>Noms clairs et spÃ©cifiques</li>
                <li>Un concept par test</li>
                <li>Tests auto-documentÃ©s</li>
            </ul>
        </div>

        <div class="practice-category">
            <h3>ğŸ”’ Edge Cases</h3>
            <ul>
                <li>Valeurs null/undefined</li>
                <li>Empty strings</li>
                <li>CaractÃ¨res spÃ©ciaux</li>
                <li>Limites (trÃ¨s long, trÃ¨s court)</li>
            </ul>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>ğŸ› Debugging et Troubleshooting</h2>

    <div class="code-block">
        <h3>Commandes de Debug</h3>
        <pre><code># Debug un test spÃ©cifique
npm run test:frontend -- tests/frontend/unit/utils/validation.test.js

# Tests avec pattern
npm run test:frontend -- --grep "password"

# Verbose output
npm run test:frontend -- --reporter=verbose

# Interface graphique
npm run test:frontend -- --ui

# Node inspector
node --inspect-brk ./node_modules/vitest/vitest.mjs run</code></pre>
    </div>

    <div class="troubleshooting">
        <h3>ProblÃ¨mes Courants</h3>

        <div class="problem-solution">
            <h4>âŒ localStorage mock ne persiste pas</h4>
            <p><strong>Solution:</strong> Utiliser un mock fonctionnel avec objet store interne, pas vi.fn()</p>
        </div>

        <div class="problem-solution">
            <h4>âŒ Tests asynchrones timeout</h4>
            <p><strong>Solution:</strong> Ajouter async/await, augmenter timeout si nÃ©cessaire</p>
        </div>

        <div class="problem-solution">
            <h4>âŒ RGB vs HEX dans tests CSS</h4>
            <p><strong>Solution:</strong> jsdom convertit hex en rgb, tester la prÃ©sence plutÃ´t que la valeur exacte</p>
        </div>

        <div class="problem-solution">
            <h4>âŒ Animations ne se terminent pas</h4>
            <p><strong>Solution:</strong> Utiliser vi.useFakeTimers() et vi.advanceTimersByTime()</p>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>ğŸ“ˆ MÃ©triques de QualitÃ©</h2>

    <div class="metrics-grid">
        <div class="metric-card success">
            <h3>âœ… Pass Rate</h3>
            <div class="metric-value">100%</div>
            <p>249/249 tests passent</p>
        </div>

        <div class="metric-card success">
            <h3>âš¡ Performance</h3>
            <div class="metric-value">~5s</div>
            <p>ExÃ©cution complÃ¨te</p>
        </div>

        <div class="metric-card success">
            <h3>ğŸ“Š Coverage</h3>
            <div class="metric-value">>80%</div>
            <p>Lignes de code couvertes</p>
        </div>

        <div class="metric-card success">
            <h3>ğŸ¯ Modules</h3>
            <div class="metric-value">13</div>
            <p>Modules testÃ©s</p>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>ğŸ“š Documentation ComplÃ¨te</h2>

    <div class="info-card">
        <h3>Guide de Tests DÃ©taillÃ©</h3>
        <p>Pour une documentation complÃ¨te des tests avec exemples de code, patterns et troubleshooting, consultez :</p>
        <ul>
            <li>
                <strong><a href="https://github.com/Tetardtek/Super-OAuth/blob/main/CLAUDE/guides/TESTING.md" target="_blank" rel="noopener noreferrer">
                    ğŸ“– CLAUDE/guides/TESTING.md
                </a></strong> - Guide complet pour agents IA (400+ lignes)
            </li>
            <li>
                <strong><a href="https://github.com/Tetardtek/Super-OAuth/blob/main/README.md#-tests" target="_blank" rel="noopener noreferrer">
                    ğŸ“˜ README.md - Section Tests
                </a></strong> - Tableau dÃ©taillÃ© des 249 tests
            </li>
            <li>
                <strong><a href="https://github.com/Tetardtek/Super-OAuth/tree/main/tests/frontend" target="_blank" rel="noopener noreferrer">
                    ğŸ’» tests/frontend/
                </a></strong> - Code source des tests sur GitHub
            </li>
        </ul>
    </div>
</div>
